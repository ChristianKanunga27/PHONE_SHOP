<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - PhoneHub</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
    --accent: #FF9500;
    --surface: #fff;
    --text: #1F2937;
    --muted: #6B7280;
    --radius: 10px;
    --shadow: 0 12px 35px rgba(0,0,0,0.08);
}

body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    background: #f5f5f5;
}

header {
    background: var(--accent);
    color: white;
    padding: 20px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
}

.container {
    max-width: 1200px;
    margin: 20px auto;
    padding: 10px;
}

button {
    cursor: pointer;
    border: none;
    border-radius: var(--radius);
    padding: 6px 12px;
    color: white;
}

.add-btn { background: green; margin-bottom: 15px;}
.edit-btn { background: #007BFF; }
.delete-btn { background: #D14343; }

table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
}

th, td {
    padding: 12px;
    border-bottom: 1px solid #ddd;
    text-align: left;
}

th { background: var(--accent); color: white; }

.phone-img{
    width:70px;
    height:70px;
    object-fit:cover;
    border-radius:8px;
}

/* Modal */

.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    justify-content:center;
    align-items:center;
}

.modal-content {
    background: white;
    padding:20px;
    border-radius: var(--radius);
    width: 400px;
}

.close {
    float:right;
    font-size:18px;
    cursor:pointer;
}

form input, textarea {
    width:100%;
    padding:8px;
    margin:6px 0 12px;
}
</style>
</head>
<body>

<header>Admin Dashboard - PhoneHub</header>

<div class="container">

<button class="add-btn" id="addPhoneBtn">
<i class="fa-solid fa-plus"></i> Add Phone
</button>

<table id="phonesTable">
<thead>
<tr>
<th>ID</th>
<th>Image</th>
<th>Name</th>
<th>Price</th>
<th>Description</th>
<th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>

<!-- MODAL -->
<div class="modal" id="phoneModal">
<div class="modal-content">

<span class="close" id="closeModal">&times;</span>

<h3 id="modalTitle">Add Phone</h3>

<form id="phoneForm">

<input type="hidden" id="phoneId">

<label>Phone Name</label>
<input type="text" id="phoneName" required>

<label>Price</label>
<input type="number" id="phonePrice" required>

<label>Description</label>
<textarea id="phoneDesc" required></textarea>

<label>Phone Image</label>
<input type="file" id="phoneImage" accept="image/*">

<img id="preview" style="width:100px;display:none;margin-top:10px;">

<button class="add-btn">Save</button>

</form>
</div>
</div>

<script>
const table = document.querySelector("#phonesTable tbody");
const modal = document.getElementById("phoneModal");
const form = document.getElementById("phoneForm");
const preview = document.getElementById("preview");

let editId = null;

/* OPEN MODAL */
addPhoneBtn.onclick = () => {
    form.reset();
    preview.style.display = "none";
    editId = null;
    modal.style.display = "flex";
};

closeModal.onclick = () => modal.style.display = "none";

/* IMAGE PREVIEW */
phoneImage.onchange = () => {
    const file = phoneImage.files[0];
    if(file){
        preview.src = URL.createObjectURL(file);
        preview.style.display = "block";
    }
};

/* FETCH PHONES */
async function fetchPhones(){
    const res = await fetch("http://localhost:3000/phones");
    const data = await res.json();

    table.innerHTML = "";

    data.forEach(phone=>{
        table.innerHTML += `
        <tr>
            <td>${phone.id}</td>
            <td><img src="${phone.image}" class="phone-img"></td>
            <td>${phone.name}</td>
            <td>${phone.price}</td>
            <td>${phone.description}</td>
            <td>
                <button class="edit-btn" onclick="editPhone(${phone.id})"><i class="fa fa-pen"></i></button>
                <button class="delete-btn" onclick="deletePhone(${phone.id})"><i class="fa fa-trash"></i></button>
            </td>
        </tr>`;
    });
}

/* SAVE PHONE */
form.onsubmit = async (e)=>{
    e.preventDefault();

    const formData = new FormData();
    formData.append("name", phoneName.value);
    formData.append("price", phonePrice.value);
    formData.append("description", phoneDesc.value);

    if(phoneImage.files[0]){
        formData.append("image", phoneImage.files[0]);
    }

    if(editId){
        await fetch(`http://localhost:3000/phones/${editId}`,{
            method:"PUT",
            body:formData
        });
    }else{
        await fetch("http://localhost:3000/phones",{
            method:"POST",
            body:formData
        });
    }

    modal.style.display = "none";
    fetchPhones();
};

/* EDIT PHONE */
async function editPhone(id){
    const res = await fetch(`http://localhost:3000/phones/${id}`);
    const phone = await res.json();

    phoneName.value = phone.name;
    phonePrice.value = phone.price;
    phoneDesc.value = phone.description;

    preview.src = phone.image;
    preview.style.display = "block";

    editId = id;
    modal.style.display = "flex";
}

/* DELETE */
async function deletePhone(id){
    if(confirm("Delete phone?")){
        await fetch(`http://localhost:3000/phones/${id}`,{method:"DELETE"});
        fetchPhones();
    }
}

fetchPhones();
</script>
</body>
</html>
