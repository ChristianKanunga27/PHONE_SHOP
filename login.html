<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Login - PhoneHub</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --accent:#FF9500;
  --surface:#ffffff;
  --text:#1F2937;
  --muted:#6B7280;
  --error:#D14343;
  --radius:10px;
  --shadow:0 12px 35px rgba(0,0,0,0.08);
  --focus:rgba(255,149,0,0.2);
}

*{box-sizing:border-box;margin:0;padding:0;}

body{
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,blue,white);
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.card{
  width:100%;
  max-width:420px;
  background:var(--surface);
  padding:30px;
  border-radius:14px;
  box-shadow:var(--shadow);
  text-align:center;
}

#one{
  font-size:26px;
  font-weight:bold;
  color:green;
  margin-bottom:20px;
}

.form-group{
  margin-bottom:18px;
  text-align:left;
}

label{
  font-size:13px;
  color:var(--muted);
  margin-bottom:6px;
  display:block;
}

.input-wrapper{
  position:relative;
}

input{
  width:100%;
  padding:12px 40px 12px 12px;
  border:1px solid #E5E7EB;
  border-radius:var(--radius);
}

.toggle-password{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  border:none;
  background:none;
  cursor:pointer;
}

.actions{
  display:flex;
  gap:10px;
  margin-top:15px;
}

.btn{
  flex:1;
  padding:12px;
  border:none;
  border-radius:var(--radius);
  background:var(--accent);
  color:white;
  font-weight:bold;
  cursor:pointer;
}

.secondary{
  flex:1;
  padding:12px;
  border-radius:var(--radius);
  border:2px solid #E5E7EB;
  background:white;
  cursor:pointer;
}

.error{
  color:var(--error);
  font-size:13px;
  margin-top:12px;
  display:none;
}
</style>
</head>

<body>

<div class="card">

<h2 id="one">WELCOME BACK TO CIA_PHONE SHOP</h2>
<h1>Login</h1>

<form id="loginForm" novalidate>

<div class="form-group">
  <label for="email">Email</label>
  <input id="email" type="email" name="email" required>
</div>

<div class="form-group input-wrapper">
  <label for="password">Password</label>
  <input id="password" type="password" name="password" required>

  <button type="button" class="toggle-password" id="togglePwd" aria-label="Toggle password">
    <i class="fa-solid fa-eye"></i>
  </button>
</div>

<div class="actions">
  <button class="btn" type="submit">Login</button>
  <button type="button" class="secondary" onclick="location.href='registra.html'">Register</button>
</div>

<div id="error" class="error"></div>

</form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  // Toggle password visibility
  const toggleBtn = document.getElementById("togglePwd");
  const passwordInput = document.getElementById("password");
  if(toggleBtn && passwordInput){
    const eyeIcon = toggleBtn.querySelector("i");
    toggleBtn.addEventListener("click", () => {
      const isPassword = passwordInput.type === "password";
      passwordInput.type = isPassword ? "text" : "password";
      eyeIcon.classList.toggle("fa-eye");
      eyeIcon.classList.toggle("fa-eye-slash");
    });
  }

  // Login form submit
  const form = document.getElementById("loginForm");
  const errorBox = document.getElementById("error");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    errorBox.style.display = "none";

    if(!email || !password){
      errorBox.textContent = "Please fill all fields.";
      errorBox.style.display = "block";
      return;
    }

    try {
      const res = await fetch("http://localhost:3000/login", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({email, password})
      });

      const data = await res.json();

      if(!res.ok){
        errorBox.textContent = data.message || "Login failed";
        errorBox.style.display = "block";
        return;
      }

      // Redirect based on role from backend
      if(data.redirect){
        window.location.href = data.redirect;
      } else {
        window.location.href = "account.html"; 
      }

    } catch(err){
      errorBox.textContent = "Server connection failed.";
      errorBox.style.display = "block";
    }
  });

});
</script>

</body>
</html>
